!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.PlexusForm=t(require("react")):e.PlexusForm=t(e.react)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";e.exports=r(1)},function(e,t,r){"use strict";function n(e){var t,r,n={};for(t=0;t<e.length;++t)r=e[t],n[s(r.path)]=r.errors;return n}function s(e){return e.join("_")}function i(e){return e.context||e.schema}var o=r(2),a=o.DOM,p=r(5),u=r(4),c=r(3);e.exports=o.createClass({displayName:"Form",getInitialState:function(){var e=this.props.values,t=this.validate(this.props.schema,e,i(this.props));return{values:e,output:e,errors:t}},componentWillReceiveProps:function(e){var t=e.values||this.state.values,r=e.values||this.state.output;this.setState({values:t,output:r,errors:this.validate(e.schema,r,i(e))})},setValue:function(e,t,r){var n=this.props.schema,s=i(this.props),o=c(p.setIn(this.state.values,e,t),n,s),a=c(p.setIn(this.state.output,e,r),n,s),u=this.validate(n,a,s);this.props.submitOnChange?this.props.onSubmit(a,null,u):this.setState({values:o,output:a,errors:u})},getValue:function(e){return p.getIn(this.state.values,e)},getErrors:function(e){return this.state.errors[s(e)]},validate:function(e,t,r){return n(this.props.validate(e,t,r))},preventSubmit:function(e){e.preventDefault()},handleSubmit:function(e){this.props.onSubmit(this.state.output,e.target.value,this.state.errors)},handleKeyPress:function(e){13===e.keyCode&&this.props.enterKeySubmits&&this.props.onSubmit(this.state.output,this.props.enterKeySubmits)},renderButtons:function(){var e=this.handleSubmit;if("function"==typeof this.props.buttons)return this.props.buttons(e);var t=(this.props.buttons||["Cancel","Submit"]).map(function(t){return a.input({type:"submit",key:t,value:t,onClick:e})});return a.p(null,t)},render:function(){var e=u.make(u,{schema:this.props.schema,context:i(this.props),fieldWrapper:this.props.fieldWrapper,sectionWrapper:this.props.sectionWrapper,handlers:this.props.handlers,hints:this.props.hints,path:[],update:this.setValue,getValue:this.getValue,getErrors:this.getErrors});return a.form({onSubmit:this.preventSubmit,onKeyPress:this.handleKeyPress,className:this.props.className},this.props.extraButtons?this.renderButtons():a.span(),e,this.renderButtons())}})},function(t){t.exports=e},function(e,t,r){"use strict";function n(e,t,r){var a,p,u=o(t,r);if(u.oneOf&&(u=i.schema(e,u,r)),u["enum"])a=e||u["enum"][0];else if("object"===u.type){a=s.merge(e);for(p in u.properties)a[p]=n((e||{})[p],u.properties[p],r)}else if("array"===u.type)for(a=[],p=0;p<(e||[]).length;++p)a[p]=n((e||[])[p],u.items,r);else a=e;return a}var s=r(5),i=r(6),o=r(7);e.exports=function(e,t,r){return s.prune(n(e,t,r))}},function(e,t,r){"use strict";e.exports={CheckBox:r(8),FileField:r(9),InputField:r(10),UserDefinedField:r(11),Selection:r(12),make:r(13)}},function(e){"use strict";var t=function(e){return"number"==typeof e&&e>=0&&e%1==0},r=function(){var e,r=Array.prototype.slice.call(arguments),n=[];for(e=0;e+1<r.length;e+=2)t(r[e])||(n={});for(e=0;e+1<r.length;e+=2)n[r[e]]=r[e+1];return n},n=function(){var e,t,r,n=Array.prototype.slice.call(arguments),s=n.every(Array.isArray)?[]:{};for(e in n){t=n[e];for(r in t)s[r]=t[r]}return s},s=function(e,t){return 0==t.length||void 0==e?e:s(e[t[0]],t.slice(1))},i=function(e,t,s){if(0==t.length)return s;var o=null==e?null:e[t[0]],s=i(o||[],t.slice(1),s);return n(e,r(t[0],s))},o=function(e){var t,r,n,s;if(null==e||""===e)t=null;else if(e.constructor===Array||e.constructor===Object){r=Array.isArray(e),t=r?[]:{};for(n in e)s=o(e[n]),null!=s&&(r?t.push(s):t[n]=s);0==Object.keys(t).length&&(t=null)}else t=e;return t},a=function(e,t){var r={},n={};for(key in t){var s=t[key];e(key,s)?r[key]=s:n[key]=s}return[r,n]},p=function(e,t){var r,n={};for(r in t)n[r]=e(t[r]);return n},u=function(e,t){var r,n={};for(r in t)n[e(r)]=t[r];return n};e.exports={object:r,merge:n,getIn:s,setIn:i,prune:o,split:a,map:p,mapKeys:u}},function(e,t,r){"use strict";var n=r(5);t.schema=function(e,t){var r,s,i;return(r=n.getIn(t,["x-hints","form","selector"]))?(s=t.oneOf.map(function(e){return n.getIn(e,["properties",r,"enum",0])||""}),i=(e||{})[r]||s[0],n.merge(n.setIn(t.oneOf[s.indexOf(i)],["properties",r],n.merge(n.getIn(t,["properties",r]),{"enum":s})),{type:"object"})):void 0}},function(e,t,r){"use strict";function n(e){var t=[].slice.call(arguments),r=Array.isArray(e)?[]:{};for(var n in e)t.indexOf(n)<0&&(r[n]=e[n]);return r}var s=r(5);e.exports=function(e,t){var r=e.$ref;if(r){if(!r.match(/^#(\/([a-zA-Z_][a-zA-Z_0-9]*|[0-9]+))*$/))throw new Error("reference "+r+" has unsupported format");return s.merge(s.getIn(t,r.split("/").slice(1)),n(e,"$ref"))}return e}},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=n.createClass({displayName:"CheckBox",handleChange:function(e){var t=e.target.checked;this.props.update(this.props.path,t,t)},render:function(){return s.input({name:this.props.key,type:"checkbox",checked:this.props.value||!1,onChange:this.handleChange})}});e.exports=i},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(5),o=r(14),a=r(15),p=n.createClass({displayName:"FileField",loadFile:function(e){var t=new FileReader,r=e.target.files[0],n=i.merge(this.props.getValue(this.props.path),{name:r.name,type:r.type,size:r.size});this.props.update(this.props.path,n,n),t.onload=function(e){n.data=e.target.result,this.props.update(this.props.path,n,n)}.bind(this),r&&("dataURL"===this.props.mode?t.readAsDataURL(r):t.readAsText(r))},render:function(){var e=this.props.fields||{},t=this.props.value||{},r=[s.input({key:"input",type:"file",onChange:this.loadFile}),s.dl({key:"fileProperties"},s.dt(null,"Name"),s.dd(null,t.name||"-"),s.dt(null,"Size"),s.dd(null,t.size||"-"),s.dt(null,"Type"),s.dd(null,t.type||"-"))];return a.section(this.props,r.concat(o.object(e,this.props)))}});e.exports=p},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(16),o=r(17),a=n.createClass({displayName:"InputField",normalize:function(e){return i[this.props.type](e)},parse:function(e){return o[this.props.type](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13===e.keyCode&&e.preventDefault()},render:function(){return s.input({type:"text",name:this.props.key,value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}});e.exports=a},function(e,t,r){"use strict";var n=r(2),s=r(16),i=r(17),o=n.createClass({displayName:"UserDefinedField",normalize:function(e){var t=s[this.props.type];return t?t(e):e},parse:function(e){var t=i[this.props.type];return t?t(e):e},handleChange:function(e){var t=this.normalize(e);this.props.update(this.props.path,t,this.parse(t))},handleKeyPress:function(e){13===e.keyCode&&e.preventDefault()},render:function(){return n.createElement(this.props.component,{value:this.props.value||"",onKeyPress:this.handleKeyPress,onChange:this.handleChange})}});e.exports=o},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(16),o=r(17),a=n.createClass({displayName:"Selection",normalize:function(e){var t=this.props.type||"string";return i[t](e)},parse:function(e){var t=this.props.type||"string";return o[t](e)},handleChange:function(e){var t=this.normalize(e.target.value);this.props.update(this.props.path,t,this.parse(t))},render:function(){var e=this.props.names;return s.select({name:this.props.key,value:this.props.value||this.props.values[0],onChange:this.handleChange},this.props.values.map(function(t,r){return s.option({key:t,value:t},e[r]||t)}))}});e.exports=a},function(e,t,r){"use strict";function n(e){return e.join("_")}var s=r(2),i=r(5),o=r(7),a=r(14),p=r(15);e.exports=function(e,t){var r=o(t.schema,t.context),u=r["x-hints"]||{},c=i.getIn(u,["form","inputComponent"]);if(t=i.merge(t,{schema:r,key:n(t.path),value:t.getValue(t.path),errors:t.getErrors(t.path),type:r.type}),c)return t=i.merge(t,{component:t.handlers[c]}),p.field(t,s.createElement(e.UserDefinedField,t));if(u.fileUpload)return console.warn("DEPRECATION WARNING: built-in file upload will be removed"),t=i.merge(t,{fields:e}),s.createElement(e.FileField,i.merge(t,{mode:u.fileUpload.mode}));if(r.oneOf)return p.section(t,a.alternative(e,t));if(r["enum"])return t=i.merge(t,{values:r["enum"],names:r.enumNames||r["enum"]}),p.field(t,s.createElement(e.Selection,t));switch(r.type){case"boolean":return p.field(t,s.createElement(e.CheckBox,t));case"object":return p.section(t,a.object(e,t));case"array":return p.section(t,a.array(e,t));case"number":case"integer":case"string":default:return p.field(t,s.createElement(e.InputField,t))}}},function(e,t,r){"use strict";function n(e,t){var r,n,s=Object.keys(t||{}),i=[];for(r in e||[])n=e[r],s.indexOf(n)>=0&&i.push(n);for(r in s)n=s[r],i.indexOf(n)<0&&i.push(n);return i}var s=r(5),i=r(6),o={alternative:function(e,t){var r=i.schema(t.getValue(t.path),t.schema);return o.object(e,s.merge(t,{schema:r}))},array:function(e,t){for(var r=(t.getValue(t.path)||[]).length+1,n=[],i=0;r>i;++i)n.push(e.make(e,s.merge(t,{schema:t.schema.items,path:t.path.concat(i)})));return n},object:function(e,t){var r=n(t.schema["x-ordering"],t.schema.properties);return r.map(function(r){return e.make(e,s.merge(t,{schema:t.schema.properties[r],path:t.path.concat(r)}))})}};e.exports=o},function(e,t,r){"use strict";var n=r(2),s=n.DOM,i=r(5),o=function(e){return null===e||0===e.length?"":"error"},a=function(e,t){var r=[];return null!==e&&e.length>0&&r.push(e),null!==t&&t.length>0&&r.push(t.join("\n")),r.join("\n\n")},p=n.createClass({displayName:"FieldWrapper",render:function(){var e=[].concat(o(this.props.errors)||[],"form-element",this.props.classes||[]);return s.div({className:e.join(" "),key:this.props.key,title:a(this.props.description,this.props.errors)},s.label({htmlFor:this.props.key},this.props.title),this.props.children)}}),u=n.createClass({displayName:"SectionWrapper",render:function(){var e=this.props.path.length,t=[].concat("form-section",e>0?"form-subsection":[],this.props.classes||[]),r=[].concat(o(this.props.errors)||[],"form-section-title");return s.fieldset({className:t.join(" "),key:this.props.key},s.legend({className:r.join(" "),title:a(this.props.description,this.props.errors)},this.props.title),this.props.children)}}),c=function(e){return{key:e.key,path:e.path,errors:e.errors,classes:i.getIn(e.schema,["x-hints","form","classes"]),title:e.schema.title,description:e.schema.description}};t.section=function(e,t){return n.createElement(e.sectionWrapper||u,c(e),t)},t.field=function(e,t){return n.createElement(e.fieldWrapper||p,c(e),t)}},function(e,t){"use strict";t.string=function(e){return e.replace(/\s+/g," ").replace(/^ /,"").replace(/\u00ad/g,"")},t.integer=function(e){return e.replace(/[^-\d]/g,"").replace(/(.)-/g,"$1")},t.number=function(e){return e.replace(/[^-\.e\d]/gi,"").replace(/(e[^e]*)e/gi,"$1").replace(/([e.][^.]*)\./gi,"$1").replace(/([^e])-/gi,"$1").replace(/(e-?\d\d\d)\d/gi,"$1")}},function(e,t,r){"use strict";var n=r(16);t.string=function(e){return n.string(e)},t.integer=function(e){return e?parseInt(n.integer(e)):null},t.number=function(e){return e?parseFloat(n.number(e)):null}}])});